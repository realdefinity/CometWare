-- Load Rayfield Library
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Create the Rayfield UI Window
local Window = Rayfield:CreateWindow({
    Name = "comet: arsenal edition",
    LoadingTitle = "Initializing comet...",
    LoadingSubtitle = "By Definity",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "Comet",
        FileName = "Comet"
    }
})

-- Create a Main Tab in the UI
local MainTab = Window:CreateTab("Arsenal", 4483362458)

-- üìÇ Folder Setup
local folderPath = "Comet"
if not isfolder(folderPath) then
    makefolder(folderPath) -- Create the Comet folder if it doesn't exist
end

-- üåê Module URLs
local modules = {
    AutoShoot = "https://raw.githubusercontent.com/realdefinity/comet/refs/heads/arsenal/AutoShoot.lua",
    ESP = "https://raw.githubusercontent.com/realdefinity/comet/refs/heads/arsenal/esp.lua",
    SilentAim = "https://raw.githubusercontent.com/realdefinity/comet/refs/heads/arsenal/SilentAim.lua"
}

-- üõ†Ô∏è Function to Download and Load Modules
local function downloadModule(name, url)
    local filePath = folderPath .. "/" .. name .. ".lua"
    if not isfile(filePath) then
        writefile(filePath, game:HttpGet(url)) -- Download the module if it doesn't exist
        print("[Comet] Downloaded module:", name)
    else
        print("[Comet] Module already exists:", name)
    end
    return loadfile(filePath)() -- Load and execute the module
end

-- üì• Download and Load Modules
local AutoShoot = downloadModule("AutoShoot", modules.AutoShoot)
local ESP = downloadModule("ESP", modules.ESP)
local SilentAim = downloadModule("SilentAim", modules.SilentAim)

-- üõ†Ô∏è Set up UI for each feature
ESP:SetupUI(MainTab)         -- Set up ESP controls in the UI
SilentAim:SetupUI(MainTab)   -- Set up Silent Aim controls in the UI
AutoShoot:SetupUI(MainTab)   -- Set up Auto Shoot controls in the UI

-- üöÄ Run the features
ESP:Run()                    -- Start ESP functionality
SilentAim:Run()              -- Start Silent Aim functionality
AutoShoot:Run(SilentAim.getClosestTarget) -- Pass Silent Aim's target detection function to Auto Shoot

-- Notify when all modules are loaded
Rayfield:Notify({
    Title = "Comet Modules Loaded",
    Content = "ESP, Silent Aim, and Auto Shoot are ready to use!",
    Duration = 5,
    Actions = {
        Ignore = {
            Name = "Okay",
            Callback = function()
                print("Comet modules loaded successfully!")
            end
        }
    }
})
